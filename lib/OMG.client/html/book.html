<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
</html>
<head>
  <meta name="google" value="notranslate">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<script type='text/javascript' src='../../../lib/Sequence/scripts/sequence.jquery.js'></script>
	<script type='text/javascript' src='../js/htmlparser.js'></script>
	<style>
	body, p, div, h1, h2, h3, h4, a, img, audio, video, blockquote, svg{
	  margin: 0;
	  padding: 0;
	}
	p {
	  padding: 0 2.5ex;
	}
	body {
	  width:100%;
		position:absolute;
		font-family: Times;
		overflow:hidden;
		font-size:62.5%
	}
	#content {
	  border: 3px solid pink;
	}
	#boundlessNutshell {
		position:absolute;
		width:100000px;
	}
	#text {
		position:absolute;
		padding: 0;
		margin: 0;
	}
	#article {
    border: 3px solid red;
    background:yellow;
	}
	#target {
	  position:fixed;
	  overflow: auto;
	}
	.media {
	  margin: 0 10px ;
	  padding: 0;
	  border: 1px solid green;
	  background: hsla(1,1,1,.6);
	}
	.right {
	  float: right;
	}
	.w50 {
	  width:50%;
	}
	.h50 {
	  height:50%;
	}
	#trial {
	  
	}
	</style>
</head>
<body>
  
  <div id="target"><div class="media image w50 h50 right">
  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   width="100px" height="100px" viewBox="-3.637 -8.005 83.496 100" enable-background="new -3.637 -8.005 83.496 100"
   xml:space="preserve" stroke="rgba(0,0,0,1)" stroke-width="0" fill="rgba(0,0,0,1)" style="cursor:pointer">
  <path d="M8.343-4.093C4.064,0.063,1.861,5.687,1.861,11.676c0,5.867,2.203,11.493,6.481,15.772l-3.668,3.789
  c-5.503-5.5-8.188-12.715-8.312-19.927C-3.519,4.587-1.193-2.381,4.551-8.005L8.343-4.093z M67.263,91.749
  c-0.486,0.246-0.974,0.246-1.588,0.246c-1.712,0-3.423-0.979-4.033-2.812l-1.347-3.423H38.047h-22.74l-1.342,3.423
  c-0.61,1.834-2.321,2.812-4.033,2.812c-0.615,0-1.102,0-1.589-0.246c-2.326-0.855-3.423-3.423-2.567-5.744l27.137-69.804
  l4.156-2.813h1.588l4.038,2.813l27.137,69.804C70.686,88.326,69.59,90.894,67.263,91.749z M21.302,2.753
  c-2.567,2.444-3.915,5.99-3.915,9.169c0,3.177,1.224,6.354,3.545,8.678l-3.423,3.425c-3.3-3.303-5.38-7.947-5.38-12.47
  c0-4.281,1.711-8.68,5.626-12.469L21.302,2.753z M33.645,81.36l-11.98-11.859L17.023,81.36H33.645z M23.377,64.977l4.038,3.912
  l7.579-7.456l-7.337-7.335L23.377,64.977z M29.736,50.063l8.311,8.191l8.316-8.191H29.736z M45.625,72.068l-7.578-7.579
  l-7.578,7.579l7.578,7.578L45.625,72.068z M30.955,45.662h13.696l-6.85-17.727L30.955,45.662z M32.18,7.642
  c0-3.057,2.567-5.624,5.621-5.624c3.181,0,5.625,2.567,5.625,5.624c0,3.056-2.444,5.624-5.625,5.624
  C34.747,13.265,32.18,10.698,32.18,7.642z M48.074,54.465l-6.969,6.968l7.579,7.456l3.668-3.544L48.074,54.465z M58.584,81.36
  l-4.52-11.613L42.448,81.36H58.584z M54.92,20.846c2.567-2.446,3.91-5.99,3.91-9.292c0-2.934-1.225-6.233-3.546-8.68l3.423-3.423
  c3.177,3.546,5.38,7.947,5.38,12.592c0,4.278-1.711,8.68-5.503,12.349L54.92,20.846z M67.879,27.691
  c4.278-4.156,6.477-9.779,6.354-15.769c0.123-5.87-2.075-11.614-6.354-15.895l3.664-3.543c5.503,5.378,8.192,12.592,8.315,19.804
  c-0.123,6.723-2.444,13.691-8.192,19.192L67.879,27.691z"/>
  </svg>
  </div <p id='trial'>Oxmox advised her not to do so, because there were thousands of bad Commas, wild. Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — it is an almost unorthographic life. One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar. The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, b, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life.</p></div>
  


	<div id='boundlessNutshell'>
	  <p id='text'>Oxmox advised her not to do so, because there were thousands of bad Commas, wild. Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — it is an almost unorthographic life. One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar. The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, b, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life.</p>
	</div>
</body>

<script type='text/javascript'>
window.onload = function(){
  
    var Document = Object.create(null);
      
		var winY = window.innerHeight
		,		winX = window.innerWidth
		,		test = document.getElementById('text')
		,		body = document.body
		,   content = test.textContent
		;
		
		Content = test.textContent;
		
		function getStyle(el, style) {
		  if(!document.getElementById) return;

		   var value = el.style[toCamelCase(style)];

		  if(!value)
		    if(document.defaultView)
		      value = document.defaultView.
		         getComputedStyle(el, "").getPropertyValue(style);

		    else if(el.currentStyle)
		      value = el.currentStyle[toCamelCase(style)];

		   return value;
		};

		function setStyle(objId, style, value) {
		  document.getElementById(objId).style[style] = value;
		};

		function toCamelCase( sInput ) {
		  var oStringList = sInput.split('-');
		  if(oStringList.length == 1)  
		    return oStringList[0];
		  var ret = sInput.indexOf("-") == 0 ? 
		      oStringList[0].charAt(0).toUpperCase() + oStringList[0].substring(1) : oStringList[0];
		  for(var i = 1, len = oStringList.length; i < len; i++){
		    var s = oStringList[i];
		    ret += s.charAt(0).toUpperCase() + s.substring(1)
		  }
		  return ret;
		};
		
		function testWidth(text, bool){
			try {
				test.innerHTML = text.join(' ');				
			}
			catch(err) {
				test.innerHTML = text;
			}
			var currWidth = parseInt(getStyle(test, "width"));

			return currWidth
	
		};
		
		testWidth.letters = function(stRay){
      var letters = [];
      try {
        var words = stRay.replace(/\s/g, '').split(''), totes = 0;
        words.forEach(function(e){
		            test.innerHTML = e;
      		      var w = parseInt(getStyle(test, "width"));
      		      totes += w;
      		      letters.push([e,w]);
      		    })
        return totes
      }
      catch (err){
        var totes = 0;
        stRay.forEach(function(e){
		            test.innerHTML = e;
      		      var w = parseInt(getStyle(test, "width"));
      		      totes += w;
      		      letters.push([e,w]);
      		    }) 
        return totes
      }
    };

    Math.mode = function (array)
    {
        if(array.length == 0)
            return null;
        var modeMap = {};
        var maxEl = array[0], maxCount = 1;
        for(var i = 0; i < array.length; i++)
        {
            var el = array[i];
            if(modeMap[el] == null)
                    modeMap[el] = 1;
            else
                    modeMap[el]++;  
            if(modeMap[el] > maxCount)
            {
                    maxEl = el;
                    maxCount = modeMap[el];
            }
        }
        return maxEl;
    }
            
    function assertContext(totalWidth, charCount, widths, charCounts, avgs, totalAvg){
      var context = {
        agent : window.navigator.userAgent,
  			winX : window.innerWidth,
  			winY : window.innerHeight,
  			screenX : window.screen.availWidth,
  			screenY : window.screen.availHeight,
  			testResults : arguments
      }
      return context
    }
    
    var context = assertContext()
    
    var Dictionary = function(){
      
      var charDict = {}
      ;
  		
  		this.letterLength = function(l){
  		  if(charDict[l.charCodeAt().toString(16)]) {
  		    this.charDict = charDict;
  		    return charDict[l.charCodeAt().toString(16)][1]
  		  }
  		  test.innerHTML = l;
  		  var w = parseInt(getStyle(test, "width"));
  		  charDict[l.charCodeAt().toString(16)] = [l,w];
  		  this.charDict = charDict;
        return w
  		};
  		
  		
  		
      var pSoup = 'qazwsxedcrfvtgbyhnujmikolp1234567890QAZWSXEDCRVFBTGNYHMUJIKLO'
  		  , puncSoup = '~!@#$^&*()_—+-={}[]|<,>.?/:;"'
  		;
  		
  		pSoup.split('').forEach(this.letterLength)
  		puncSoup.split('').forEach(this.letterLength)
  		
  		this.charDict = charDict
  		
  		return this
  		
    }
    
    D = new Dictionary()	
    
    var Template = function(context){
      var d = this.dimensions = { // page dimensions and vector, within the "book" template
  			'height' : (context.winY >= 720) ? 90 : 95,
  	  	'width' : (context.winX >= 960 ) ? 61.7 : 95,
  	  	'top': (context.winY <= 720) ? 2.5 : 5,
  	  	'left': (context.winX <= 960 ) ? 2.5 : 38.3 / 2,
  	  	emRatio : 10, // this is set in the css body declaration for font size as 62.5% src: 
  		  fontSize : 1.35,
  		  padding : 10,
  		  charsPerLine : 72, // approximate
  		  lineWidth : null,
  		  LinesPerPage : null,
  		};
  		
		  d.lineHeight = Math.floor(d.fontSize *  1.63);
  		d.lineWidth = Math.floor(d.width); // Math.min(charsPerLine * pixelsPerChar + 20, targetDimension.width)// room for innacuracy?
  		d.linesPerPage = Math.floor((d.height) / d.lineHeight);
  		d.lineUnitRect = [d.lineWidth, d.lineHeight];
  		
  		$('#target').css({
  		  height: d.height + '%',
  		  width: d.width + '%',
  		  top: d.top + '%',
  		  left: d.left + '%',
  		  'line-height' : d.lineHeight + 'em'
  		})
  		
  		$('#target').css('font-size', d.fontSize + 'em')
  		test.style['font-size'] = d.fontSize + 'em';
  		body.style['font-size'] = d.fontSize + 'em';
  		
  		this.line = function(x, height, width, percent){
  		  var el = document.createElement('div');
        el.setAttribute('class', 'media');
        el.style.width = d.lineWidth + 'px';
        el.style.height = d.lineHeight + 'em';
        el.style.top = x * d.lineHeight + 'px';
        return el
  		}
  		
  		return this
    }
    
    template = new Template(assertContext())
    
    function divitup(x,i){
      var line = new template.line(x);
      console.log(line.style.width)
      $('#target').append($(line))
    }

    _.range(template.dimensions.linesPerPage).forEach(divitup)
    
    template.assembleContent = function (content){
      var c = content, t = template, self = this, d = this.dimensions;
      
      var words = content.split(' ')
        , page = 0
        , pages = []
        , lineNo = 0
        , lines = []
        ;
        
      var line = lines[0] = new self.line()
      

      
      console.log(self)
      
      
      
    }; template.assembleContent(Content, template)
    
    
}
	
</script>
</html>