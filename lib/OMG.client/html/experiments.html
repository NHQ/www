<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
</html>
<head>
  <meta name="google" value="notranslate">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<script type='text/javascript' src='../../../lib/Sequence/scripts/sequence.jquery.js'></script>
	<script type='text/javascript' src='../js/htmlparser.js'></script>
	<style>
	body, p, div, h1, h2, h3, h4, a, img, audio, video, blockquote, svg{
	  margin: 0;
	  padding: 0;
	}
	body {
	  width:100%;
		position:absolute;
		font-family: monospace;
		overflow:hidden;
		font-size:62.5%
	}
	#content {
	  border: 3px solid pink;
	}
	#boundlessNutshell {
		position:absolute;
		width:100000px;
	}
	#text {
	  bordeR: 1px solid black;
		position:absolute;
	}
	#article {
    border: 3px solid red;
    background:yellow;
	}
	#target {
	  position:fixed;
	  border:7px solid orange;
	}
	</style>
</head>
<body>
  
  <div id="target"></div>
  
  <div id='content'>
        <p id='article' class='media'>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — <a href="#">it is</a> an almost unorthographic life. One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar. <img src="" height="100px" width="100px"></img>The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, b, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — it is an almost unorthographic life. </p>
        <iframe id="abc" class="media audio w100" scrolling="no" frameborder="no" src="http://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F37058250&amp;auto_play=false&amp;show_artwork=false&amp;color=ff7700"></iframe>
        <blockquote>Pointing has no control about the blind texts — it is an almost unorthographic life</blockquote>
        <p id=''>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — it is an almost unorthographic life. One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar. The Big Oxmox advised her not to do so, because there were thousands of bad Commas, wild Question Marks and devious Semikoli, b, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth. Even the all-powerful Pointing has no control about the blind texts — it is an almost unorthographic life. </p>
    <div class="media image w50 right">
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="100px" height="100px" viewBox="-3.637 -8.005 83.496 100" enable-background="new -3.637 -8.005 83.496 100"
     xml:space="preserve" stroke="rgba(0,0,0,1)" stroke-width="0" fill="rgba(0,0,0,1)" style="cursor:pointer">
    <path d="M8.343-4.093C4.064,0.063,1.861,5.687,1.861,11.676c0,5.867,2.203,11.493,6.481,15.772l-3.668,3.789
    c-5.503-5.5-8.188-12.715-8.312-19.927C-3.519,4.587-1.193-2.381,4.551-8.005L8.343-4.093z M67.263,91.749
    c-0.486,0.246-0.974,0.246-1.588,0.246c-1.712,0-3.423-0.979-4.033-2.812l-1.347-3.423H38.047h-22.74l-1.342,3.423
    c-0.61,1.834-2.321,2.812-4.033,2.812c-0.615,0-1.102,0-1.589-0.246c-2.326-0.855-3.423-3.423-2.567-5.744l27.137-69.804
    l4.156-2.813h1.588l4.038,2.813l27.137,69.804C70.686,88.326,69.59,90.894,67.263,91.749z M21.302,2.753
    c-2.567,2.444-3.915,5.99-3.915,9.169c0,3.177,1.224,6.354,3.545,8.678l-3.423,3.425c-3.3-3.303-5.38-7.947-5.38-12.47
    c0-4.281,1.711-8.68,5.626-12.469L21.302,2.753z M33.645,81.36l-11.98-11.859L17.023,81.36H33.645z M23.377,64.977l4.038,3.912
    l7.579-7.456l-7.337-7.335L23.377,64.977z M29.736,50.063l8.311,8.191l8.316-8.191H29.736z M45.625,72.068l-7.578-7.579
    l-7.578,7.579l7.578,7.578L45.625,72.068z M30.955,45.662h13.696l-6.85-17.727L30.955,45.662z M32.18,7.642
    c0-3.057,2.567-5.624,5.621-5.624c3.181,0,5.625,2.567,5.625,5.624c0,3.056-2.444,5.624-5.625,5.624
    C34.747,13.265,32.18,10.698,32.18,7.642z M48.074,54.465l-6.969,6.968l7.579,7.456l3.668-3.544L48.074,54.465z M58.584,81.36
    l-4.52-11.613L42.448,81.36H58.584z M54.92,20.846c2.567-2.446,3.91-5.99,3.91-9.292c0-2.934-1.225-6.233-3.546-8.68l3.423-3.423
    c3.177,3.546,5.38,7.947,5.38,12.592c0,4.278-1.711,8.68-5.503,12.349L54.92,20.846z M67.879,27.691
    c4.278-4.156,6.477-9.779,6.354-15.769c0.123-5.87-2.075-11.614-6.354-15.895l3.664-3.543c5.503,5.378,8.192,12.592,8.315,19.804
    c-0.123,6.723-2.444,13.691-8.192,19.192L67.879,27.691z"/>
    </svg>
    </div>
    	    <iframe class="media video youtube w65 left" src="http://www.youtube.com/embed/i3Jv9fNPjgk" frameborder="0" allowfullscreen></iframe>
</div>

	<div id='boundlessNutshell'>
	  <p id='text'>Oxmox advised her not to do so, because there were thousands of bad Commas, wild.</p>
	</div>
</body>

<script type='text/javascript'>
window.onload = function(){
  
    var Document = Object.create(null);
      
		var winY = window.innerHeight
		,		winX = window.innerWidth
		,		test = document.getElementById('text')
		,		article = document.getElementById('article')
		,		body = document.body
		,   emRatio = 10 // this is set in the css body declaration for font size as 62.5% src: 
		, 	fontSize = 2 * emRatio
		,		charsPerLine = 72
		,   lineHeight = Math.ceil(fontSize * 1.62)
		,   targetDimension = {
		      'height' : Math.min(winY * .9 , 720),
    		  'width' : Math.min(winX / 1.62, 960),
    		  'top': (winY - Math.min(winY * .9 , 720)) / 3,
    		  'left': (winX - Math.min(winX / 1.62, 960)) / 2
    		}
		;
		
		
		var data = {
		  userAgent : window.navigator.userAgent,
		  winX : winX,
		  winY : winY		  
		};
		
		$.post('/' + encodeURIComponent(JSON.stringify(data)), {}, function(e,r){console.log(e,r)})
    
		
		
		$('#target').css(targetDimension)
    
		
		article.style['font-size'] = fontSize + 'px'
		test.style['font-size'] = fontSize + 'px'		
		body.style['font-size'] = fontSize + 'px'
		
		function getStyle(el, style) {
		  if(!document.getElementById) return;

		   var value = el.style[toCamelCase(style)];

		  if(!value)
		    if(document.defaultView)
		      value = document.defaultView.
		         getComputedStyle(el, "").getPropertyValue(style);

		    else if(el.currentStyle)
		      value = el.currentStyle[toCamelCase(style)];

		   return value;
		}

		function setStyle(objId, style, value) {
		  document.getElementById(objId).style[style] = value;
		}

		function toCamelCase( sInput ) {
		  var oStringList = sInput.split('-');
		  if(oStringList.length == 1)  
		    return oStringList[0];
		  var ret = sInput.indexOf("-") == 0 ? 
		      oStringList[0].charAt(0).toUpperCase() + oStringList[0].substring(1) : oStringList[0];
		  for(var i = 1, len = oStringList.length; i < len; i++){
		    var s = oStringList[i];
		    ret += s.charAt(0).toUpperCase() + s.substring(1)
		  }
		  return ret;
		}
		
		function testWidth(text){
			try {
				test.innerHTML = text.join(' ');				
			}
			catch(err) {
				test.innerHTML = text;
			}
			var currWidth = parseInt(getStyle(test, "width"));

			return currWidth
		}

		var currWidth = parseInt(getStyle(test, "width"));
		var bodyWidth = parseInt(getStyle(document.body, "width"));
		var pixelsPerChar = Math.ceil(currWidth / test.textContent.length);
		var charConst = Math.ceil(fontSize / pixelsPerChar); // font-size / pixelsPerChar
		var widthFactor = charsPerLine / charConst; // CPL / charConst
		var lineWidth = Math.min(charsPerLine * pixelsPerChar + 20, targetDimension.width)// room for innacuracy?
		,		linesPerPage = Math.floor(( .75 * winY ) / Math.floor(18 * 1.62))
		,		charsPerPage = linesPerPage * (lineWidth / pixelsPerChar)
		;

    console.log('XXXXXXX', currWidth)

		article.style.width = lineWidth + 'px'; // Math.floor(lineWidth) + 'px';
		article.style['line-height'] = lineHeight + 'px';

    console.log(currWidth, pixelsPerChar, test.textContent.length, test.textContent )

//		article.textContent = article.textContent.slice(0, charsPerPage);
		
		var lastLine = (linesPerPage - 1) *  charsPerLine;
		
		var implant = function(lines){
			var text = lines.join('<br />')
			var p = document.createElement('p'); 
			p.style.width = lineWidth + 'px';
			p.innerHTML = text;
			article.style.width = lineWidth + 'px';
			article.innerHTML = '';
			article.appendChild(p)
			$(article).css(targetDimension).css({position:'fixed'})
  		
		}
		
		var doLines = function(text){
			var text = text.replace(/\n/g, '')
			,		words = text.split(/\s/)
			,		paragraphs = text.split(/\n/)
			,		lines = []
			,		x = 0
			,		y = 0
			,		c = 0
			;
			
			var line = new function(obj){
			  this.width = lineWidth
			  this.charPerLine = charsPerLine
			}
			
			window.omg = lines
			
			var wordFn = function(words){
								
				if(!words.length) { return implant(lines)} // <--- endpoint
				
				var words = words
				,		word = words.splice(0,1)[0] // String
				,		l = word.length
				,   length = testWidth(word)
				,		lc = l * pixelsPerChar
				,		fullStop = (word.lastIndexOf('.') === l - 1)
				,		ceasura  = (word.lastIndexOf(',') === l - 1)
				;
        console.log(word, length)
				if((length + c) <= lineWidth) { // pixels width
					
					lines[x] ? (lines[x] += word + ' ') : (lines[x] = word + ' ')
					c  += ((length + c) === charsPerLine) ? length : length + pixelsPerChar;
					wordFn(words)
					return
					
				}
					
				else if(length + c > lineWidth) {
					
					var overage = (length + c) - charsPerLine;
					
					words.unshift(word);
					++x;
					c = 0;
					wordFn(words)
					return						
				
				};
					
			}; 
			
			wordFn(words)			
		
		};
  	console.log(content)
  	
  	function doContent(content) {
  	  var content = content
  	  ,   children = content.children
  	  ;
  	  
  	  children.forEach(function(elem){
  	    switch(elem){
  	    }
  	  })
  	  
  	}
		
	doLines(article.innerHTML)
	
	
	
}
	
</script>
</html>